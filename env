#!/usr/bin/env bash

# aliases and functions {{{

# recipetool
alias \
    create-append='recipetool newappend' \

# runqemu
alias \
    rqg='runqemu slirp qemux86-64'

bbe() {
    [ $# -eq 1 ] || return 1;
    output_file="${1//\//_}.env"
    bitbake -e "$1" | tee "$output_file"
    echo "$output_file"
}

getvar() {
    case "$#" in
        1)
            bitbake-getvar "$1" | sed -nE "s|$1=\"(.*)\"|\1|p"
            ;;
        2)
            bitbake-getvar -r "$2" "$1" | sed -nE "s|$1=\"(.*)\"|\1|p"
            ;;
        *)
            echo "wrong \$#"
            ;;
    esac
}

gets() {
    [ $# -eq 1 ] || return 1;
    getvar S "$1"
}

getb() {
    [ $# -eq 1 ] || return 1;
    getvar B "$1"
}

getworkdir() {
    [ $# -eq 1 ] || return 1;
    getvar WORKDIR "$1"
}

cdb() {
    [ $# -eq 1 ] || return 1;
    B=$(getb "$1")
    [ -d "$B" ] && cd "$B" || return 1;
}

cds() {
    [ $# -eq 1 ] || return 1;
    S=$(gets "$1")
    [ -d "$S" ] && cd "$S" || return 1;
}

cdworkdir() {
    [ $# -eq 1 ] || return 1;
    WORKDIR=$(getworkdir "$1")
    [ -d "$WORKDIR" ] && cd "$WORKDIR" || return 1;
}

# }}}

